## 多元运算  

当我在早上醒来，不禁思考一个问题：“为什么学习一门新的技术会如此艰难？”  
我并不认为困难仅仅来自于知识本身。其中一个重要原因是：我们花费了大量的时间和精力在阅读与观察上，却无暇顾及实践应用。就拿游泳来说，我们可以花很长时间阅读教材、与教练交流经验、观看教学视频，但是第一次下水时，仍然会像石头一样下沉。
纸上得来终觉浅，绝知此事要躬行。所以我在[第一章](http://ruslanspivak.com/lsbasi-part1/)和[第二章](http://ruslanspivak.com/lsbasi-part2/)设置了一些练习来帮助训练。当然，后面还会有一大波习题正在袭来。我保证:)  

迄今为止，我们已经学会了诸如"7 + 3"、"12-9"二元加减法。今天我们就将讨论，如何使我们的计算器支持像"7 - 3 + 2 - 1"这样的任意位数的加减法运算。  
我们可以用下面的`语法图(syntax diagram)`来表示本文中的计算器：  
![lsbasi_part3_syntax_diagram.png](img/03/lsbasi_part3_syntax_diagram.png)  

什么是语法图？语法图就是对一种编程语言语法规则的示意图。通俗来讲，通过语法图，我们可以直观地看出哪些语句是合法的，哪些语句是非法的。  
语法图通俗易懂：只要跟随箭头指示的路径往下走就行了。有限路径代表着选择；有些路径代表着循环。  
我们可以按顺序来阅读上面的语法图：一个`term``(本文中就是一个整数)`后面选择性地跟着一个`加号`或者`减号`，`+/-`后面再跟一个整数，然后选择性地绕回来后面再跟着运算符和整数，如此往复。  
使用语法图有两个目的：  
- 图形化展示一种编程语言的(语法)定义  
- 通过跟随简单的语法规则，沿语法图的路径编码。可以帮助我们写出自己的解析器  

我们前面已经掌握了如何将`token`流识别为短语的过程，也就是`解析(parsing)`或`语法分析(syntax analysis)`。编译器或解释器负责解析工作的部分也被称为`解析器(parser)`或`语法分析器(syntax analyzer)`。
根据上面的语法图，我们可以得到下面的表达式是合法的：  
- 3  
- 3 + 4  
- 7 - 3 + 2 - 1  
这写语法规则类似于`Python`命令，和一般的编程语言不太像，我们可以启动`Python`的解释器来比较一下：  
```python
>>> 3
3
>>> 3 + 4
7
>>> 7 - 3 + 2 - 1
5
```  
不出所料。  
表达式"3 + "是非法表达式，因为加号后面必须要跟一个`term(整数)`，这就是一个语法错误。不信可以试一试：  
```python
>>> 3 +
  File "<stdin>", line 1
    3 +
      ^
SyntaxError: invalid syntax
```  
能用`Python`来验证固然是极好的，我们是否可以根据上图构建解释器然后再做测试？  

我们知道，在前面([第一章](http://ruslanspivak.com/lsbasi-part1/)和[第二章](http://ruslanspivak.com/lsbasi-part2/))`expr()`方法扮演着解析器和解释器的角色。再啰嗦一句：解析器确保token流的结构符合语法规则；在解析完成后解释器进行相关计算并返回结果。  
下面的代码，就是参照语法图编写的。语法图中的方框`term`变成了`term()`方法来解析整数，`expr()`就是语法图的执行流程：  
```python
def term(self):
    self.eat(INTEGER)

def expr(self):
    # 将输入的第一个token 设置为当前token
    self.current_token = self.get_next_token()

    self.term()
    while self.current_token.type in (PLUS, MINUS):
        token = self.current_token
        if token.type == PLUS:
            self.eat(PLUS)
            self.term()
        elif token.type == MINUS:
            self.eat(MINUS)
            self.term()
```  
## 未完待续

下面是一些有用的参考资料：   
1. [Language Implementation Patterns: Create Your Own Domain-Specific and General Programming Languages (Pragmatic Programmers)](http://www.amazon.com/gp/product/193435645X/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=193435645X&linkCode=as2&tag=russblo0b-20&linkId=MP4DCXDV6DJMEJBL)  
2. [Writing Compilers and Interpreters: A Software Engineering Approach](http://www.amazon.com/gp/product/0470177071/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=0470177071&linkCode=as2&tag=russblo0b-20&linkId=UCLGQTPIYSWYKRRM)  
3. [Modern Compiler Implementation in Java](http://www.amazon.com/gp/product/052182060X/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=052182060X&linkCode=as2&tag=russblo0b-20&linkId=ZSKKZMV7YWR22NMW)  
4. [Modern Compiler Design](http://www.amazon.com/gp/product/1461446988/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=1461446988&linkCode=as2&tag=russblo0b-20&linkId=PAXWJP5WCPZ7RKRD)  
5. [Compilers: Principles, Techniques, and Tools (2nd Edition)](http://www.amazon.com/gp/product/0321486811/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=0321486811&linkCode=as2&tag=russblo0b-20&linkId=GOEGDQG4HIHU56FQ)  
-----
[^1]. [The 5 Elements of Effective Thinking](http://www.amazon.com/gp/product/0691156662/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=0691156662&linkCode=as2&tag=russblo0b-20&linkId=B7GSVLONUPCIBIVY)

-----  

[阅读原文](https://ruslanspivak.com/lsbasi-part2/)  
第二章要简单许多，(ง •_•)ง