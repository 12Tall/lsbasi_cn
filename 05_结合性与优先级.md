## 结合性与优先级  
  
你是如何理解构建解释器/编译器这么复杂的问题的？刚开始的时候就像一团乱麻，我们首先要做的就是理清头绪，然后将乱麻理成线团。  

解决问题最好的方法就是一步一个脚印。有时候你可能觉得并不能立即弄清楚某些概念，那也要坚持。我保证，山重水复之后，总会柳暗花明(如果我每次遇到难以理解的问题就攒下五毛钱的话，那我现在肯定是百万富翁了:)  

就如何构建解释器/编译器而言，我能给出的最好的建议就是看这些文章里的解释，阅读源码并且亲自动手实践。书读百遍，其意自见。不要着急，慢慢来就好了，仔细理解每一个基本概念。相信我，这种方法看似缓慢，但是对将来大有好处。  

我们最终会理出一个完美的“线团”，就算它不是那么完美无暇，那也比匆匆一瞥，一无所获要好得多。  

记住，一次做好一件事，通过写代码来提升自己，你将受益良多：  

![lsbasi_part5_ballofyarn.png](./img/05/lsbasi_part5_ballofyarn.png)  


今天，我们将会用到以往所学的全部知识，包括如何解析并解释算术运算。我们会写出一个可以计算类似于`14 + 2 * 3 - 6 / 2` 的解释器程序。  

开工之前，我们先来谈一下`运算符` 的`结合性(associativity)` 与`优先级(precedence)`。

按照常理 7+3+1 和(7+3)+1 一样，7-3-1 与(7-3)-1 相同。这些都是我们早就习惯的只是东西，如果我们认为(7-3)-1 等于 7-(3-1) 那结果应该是5 而不是3。  

在一般算数和大多数编程语言中，加减乘除运算符都具有左结合性。  
```
7 + 3 + 1 is equivalent to (7 + 3) + 1
7 - 3 - 1 is equivalent to (7 - 3) - 1
8 * 4 * 2 is equivalent to (8 * 4) * 2
8 / 4 / 2 is equivalent to (8 / 4) / 2
```

那么什么是左结合性呢？  

我们约定：当一个操作数处于两个相同操作符之间时，会优先与左侧的运算符进行运算。例如：7+3+1 等价于(7+3)+1。这就是左结合性。  

那么如果两侧的运算符不同呢？例如：`7+5*2`，5 应该先与那个运算符进行运算呢？是 `7+(5*2)` 还是 `(7+5)*2`？  

显然，结合性不能为我们解决这个问题，因为结合性只在同一类运算符中有效，例如：加和减、乘和除。所以我们又约定：乘除运算比加减运算具有更高的优先级。所以`7+5*2`等价于`7+(5*2)`。  

当算式中所有运算符的优先级相同时，我们只需要用到结合性，从左向右进行计算即可：  
```
7 + 3 - 1 等价于 (7 + 3) - 1
8 / 4 * 2 等价于 (8 / 4) * 2
```

### todo